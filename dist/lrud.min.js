!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Lrud=e()}(this,function(){"use strict";function t(){}function e(){this.nodes={},this.root=null,this.currentFocus=null}t.prototype={on:function(t,e,i){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:i}),this},once:function(t,e,i){function n(){r.off(t,n),e.apply(i,arguments)}var r=this;return n._=e,this.on(t,n,i)},emit:function(t){for(var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),n=0,r=i.length;n<r;n++)i[n].fn.apply(i[n].ctx,e);return this},off:function(t,e){var i=this.e||(this.e={}),n=i[t],r=[];if(n&&e)for(var o=0,s=n.length;o<s;o++)n[o].fn!==e&&n[o].fn._!==e&&r.push(n[o]);return r.length?i[t]=r:delete i[t],this}};var i=t,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,s,c=function(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),h=1;h<arguments.length;h++){i=Object(arguments[h]);for(var d in i)r.call(i,d)&&(c[d]=i[d]);if(n){s=n(i);for(var u=0;u<s.length;u++)o.call(i,s[u])&&(c[s[u]]=i[s[u]])}}return c},c="LEFT",h="RIGHT",d="DOWN",u="ENTER",a={map:{LEFT:c,RIGHT:h,UP:"UP",DOWN:d,ENTER:u},codes:{4:c,21:c,37:c,214:c,205:c,218:c,5:h,22:h,39:h,213:h,206:h,217:h,29460:"UP",19:"UP",38:"UP",211:"UP",203:"UP",215:"UP",29461:d,20:d,40:d,212:d,204:d,216:d,29443:u,13:u,67:u,32:u,23:u,195:u}},l=function(t,e,i){return t===e||t===i};e.prototype=Object.create(i.prototype),s(e.prototype,{register:function(t,e){if(!t)throw new Error("Attempting to register with an invalid id");var i=this._createNode(t,e);if(i.parent){var n=this._createNode(i.parent);-1===n.children.indexOf(t)&&n.children.push(t),this.nodes[i.parent]=n}else this.root=t;this.nodes[t]=i},unregister:function(t){var e=this.nodes[t];if(e){var i=this.nodes[e.parent];i&&(i.children=i.children.filter(function(e){return e!==t}),i.activeChild===t&&(i.activeChild=void 0)),this.currentFocus===t&&(this.blur(),this.currentFocus=void 0),delete this.nodes[t],e.children.forEach(this.unregister.bind(this))}},blur:function(t){var e=this.nodes[t]||this.nodes[this.currentFocus];e&&this.emit("blur",e.id)},focus:function(t){var e=this.nodes[t]||this.nodes[this.currentFocus]||this.nodes[this.root];if(e){var i=e.activeChild||e.children[0];if(i)return this.focus(i);this.blur(),this.currentFocus=e.id,this.emit("focus",this.currentFocus),this._bubbleActive(this.currentFocus)}},handleKeyEvent:function(t){this._bubbleKeyEvent(t,this.currentFocus)},destroy:function(){this.e={},this.nodes={},this.root=null,this.currentFocus=null},setActiveChild:function(t,e){var i=this.nodes[t];i&&-1!==i.children.indexOf(e)&&i.activeChild!==e&&(i.activeChild&&this.emit("inactive",i.activeChild),this.emit("active",e),i.activeChild=e)},setActiveIndex:function(t,e){var i=this.nodes[t];i&&i.children[e]&&this.setActiveChild(t,i.children[e])},_createNode:function(t,e){return s({id:t,children:[]},this.nodes[t]||{},e||{})},_updateGrid:function(t){var e=t.activeChild||t.children[0],i=this.nodes[e],n=i.activeChild||i.children[0],r=i.children.indexOf(n);t.children.forEach(function(t){this.setActiveIndex(t,Math.min(this.nodes[t].children.length-1,r))}.bind(this))},_bubbleKeyEvent:function(t,i){var n=this.nodes[i];if(n){var r=e.KEY_CODES[t.keyCode];if(r===e.KEY_MAP.ENTER)return this.emit("select",i);if(function(t,i){return"horizontal"===i.orientation&&l(e.KEY_CODES[t.keyCode],e.KEY_MAP.LEFT,e.KEY_MAP.RIGHT)||"vertical"===i.orientation&&l(e.KEY_CODES[t.keyCode],e.KEY_MAP.UP,e.KEY_MAP.DOWN)}(t,n)){var o=n.activeChild||n.children[0],s=n.children.indexOf(o),c=l(r,e.KEY_MAP.RIGHT,e.KEY_MAP.DOWN)?1:-1,h=s+c,d=n.children.length,u=n.wrapping?(h+d)%d:h,a=n.children[u];if(a)return n.grid&&this._updateGrid(n),this.emit("move",{id:i,offset:c,orientation:n.orientation,enter:{id:a,index:u},leave:{id:o,index:s}}),this.focus(a),t.stopPropagation()}this._bubbleKeyEvent(t,n.parent)}},_bubbleActive:function(t){var e=this.nodes[t];e.parent&&(this.setActiveChild(e.parent,t),this._bubbleActive(e.parent))}}),e.KEY_MAP=a.map,e.KEY_CODES=a.codes;return e});