!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Lrud=e()}(this,function(){"use strict";function t(){}function e(){this.nodes={},this.root=null,this.currentFocus=null}function i(t,e,i){return c({id:e,children:[]},t.nodes[e]||{},i||{})}t.prototype={on:function(t,e,i){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:i}),this},once:function(t,e,i){function n(){r.off(t,n),e.apply(i,arguments)}var r=this;return n._=e,this.on(t,n,i)},emit:function(t){for(var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),n=0,r=i.length;n<r;n++)i[n].fn.apply(i[n].ctx,e);return this},off:function(t,e){var i=this.e||(this.e={}),n=i[t],r=[];if(n&&e)for(var o=0,s=n.length;o<s;o++)n[o].fn!==e&&n[o].fn._!==e&&r.push(n[o]);return r.length?i[t]=r:delete i[t],this}};var n=t,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,c=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,n,c=function(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),h=1;h<arguments.length;h++){i=Object(arguments[h]);for(var u in i)o.call(i,u)&&(c[u]=i[u]);if(r){n=r(i);for(var d=0;d<n.length;d++)s.call(i,n[d])&&(c[n[d]]=i[n[d]])}}return c},h="LEFT",u="RIGHT",d="DOWN",a="ENTER",f={map:{LEFT:h,RIGHT:u,UP:"UP",DOWN:d,ENTER:a},codes:{4:h,21:h,37:h,214:h,205:h,218:h,5:u,22:u,39:u,213:u,206:u,217:u,29460:"UP",19:"UP",38:"UP",211:"UP",203:"UP",215:"UP",29461:d,20:d,40:d,212:d,204:d,216:d,29443:a,13:a,67:a,32:a,23:a,195:a}},l=function(t,e,i){return t===e||t===i};e.prototype=Object.create(n.prototype),c(e.prototype,{register:function(t,e){if(!t)throw new Error("Attempting to register with an invalid id");var n=i(this,t,e);if(n.parent){var r=i(this,n.parent);-1===r.children.indexOf(t)&&r.children.push(t),this.nodes[n.parent]=r}else this.root=t;this.nodes[t]=n},unregister:function(t){var e=this.nodes[t];if(e){var i=this.nodes[e.parent];i&&(i.children=i.children.filter(function(e){return e!==t}),i.activeChild===t&&(i.activeChild=void 0)),this.currentFocus===t&&(this.blur(t),this.currentFocus=void 0),delete this.nodes[t],e.children.forEach(this.unregister.bind(this))}},blur:function(t){t=t||this.currentFocus,this.nodes[t]&&this.emit("blur",t)},focus:function(t){t=t||this.root;var e=this.nodes[t];if(e){var i=e.activeChild||e.children[0];if(i)return this.focus(i);this.blur(),this.currentFocus=t,this.emit("focus",t),this._bubbleActive(t)}},handleKeyEvent:function(t){this._bubbleKeyEvent(t,this.currentFocus)},destroy:function(){this.e={},this.nodes={},this.currentFocus=null},setActiveChild:function(t,e){var i=this.nodes[t];if(i&&-1!==i.children.indexOf(e)){var n=i.activeChild;n!==e&&(n&&this.emit("inactive",n),this.emit("active",e),i.activeChild=e)}},setActiveIndex:function(t,e){var i=this.nodes[t];i&&i.children[e]&&this.setActiveChild(t,i.children[e])},_updateGrid:function(t){var e=t.activeChild||t.children[0],i=this.nodes[e],n=i.activeChild||i.children[0];if(n){var r=i.children.indexOf(n);t.children.forEach(function(t){this.setActiveIndex(t,Math.min(this.nodes[t].children.length-1,r))}.bind(this))}},_bubbleKeyEvent:function(t,i){var n=this.nodes[i];if(n){var r=e.KEY_CODES[t.keyCode];if(r===e.KEY_MAP.ENTER)return this.emit("select",i);if(function(t,i){return"horizontal"===i.orientation&&l(e.KEY_CODES[t.keyCode],e.KEY_MAP.LEFT,e.KEY_MAP.RIGHT)||"vertical"===i.orientation&&l(e.KEY_CODES[t.keyCode],e.KEY_MAP.UP,e.KEY_MAP.DOWN)}(t,n)){var o=n.activeChild||n.children[0],s=n.children.indexOf(o),c=l(r,e.KEY_MAP.RIGHT,e.KEY_MAP.DOWN)?1:-1,h=s+c,u=n.children.length,d=n.wrapping?(h+u)%u:h,a=n.children[d];if(a)return n.grid&&this._updateGrid(n),this.emit("move",{id:i,offset:c,orientation:n.orientation,enter:{id:a,index:d},leave:{id:o,index:s}}),this.focus(a),t.stopPropagation()}this._bubbleKeyEvent(t,n.parent)}},_bubbleActive:function(t){var e=this.nodes[t];e.parent&&(this.setActiveChild(e.parent,t),this._bubbleActive(e.parent))}}),e.KEY_MAP=f.map,e.KEY_CODES=f.codes;return e});