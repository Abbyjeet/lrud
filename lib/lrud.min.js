!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Lrud=t()}(this,function(){"use strict";function e(){}function t(){t.init.call(this)}function n(e){return void 0===e._maxListeners?t.defaultMaxListeners:e._maxListeners}function i(t,i,r,o){var s,u,h;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((u=t._events)?(u.newListener&&(t.emit("newListener",i,r.listener?r.listener:r),u=t._events),h=u[i]):(u=t._events=new e,t._eventsCount=0),h){if("function"==typeof h?h=u[i]=o?[r,h]:[h,r]:o?h.unshift(r):h.push(r),!h.warned&&(s=n(t))&&s>0&&h.length>s){h.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+i+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=i,a.count=h.length,function(e){"function"==typeof console.warn?console.warn(e):console.log(e)}(a)}}else h=u[i]=r,++t._eventsCount;return t}function r(e,t,n){function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}var r=!1;return i.listener=n,i}function o(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function s(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function u(){this.nodes={},this.currentFocus=null}function h(e){return e=e||{},{parent:e.parent,children:e.children||[],activeChild:e.activeChild,orientation:e.orientation,wrapping:e.wrapping,grid:e.grid,carousel:e.carousel,data:e.data}}var a;e.prototype=Object.create(null),t.EventEmitter=t,t.usingDomains=!1,t.prototype.domain=void 0,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.init=function(){this.domain=null,t.usingDomains&&(!a.active||this instanceof a.Domain||(this.domain=a.active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new e,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},t.prototype.getMaxListeners=function(){return n(this)},t.prototype.emit=function(e){var t,n,i,r,o,u,h,a="error"===e;if(u=this._events)a=a&&null==u.error;else if(!a)return!1;if(h=this.domain,a){if(t=arguments[1],!h){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=h,t.domainThrown=!1,h.emit("error",t),!1}if(!(n=u[e]))return!1;var f="function"==typeof n;switch(i=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var i=e.length,r=s(e,i),o=0;o<i;++o)r[o].call(n)}(n,f,this);break;case 2:!function(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,o=s(e,r),u=0;u<r;++u)o[u].call(n,i)}(n,f,this,arguments[1]);break;case 3:!function(e,t,n,i,r){if(t)e.call(n,i,r);else for(var o=e.length,u=s(e,o),h=0;h<o;++h)u[h].call(n,i,r)}(n,f,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,i,r,o){if(t)e.call(n,i,r,o);else for(var u=e.length,h=s(e,u),a=0;a<u;++a)h[a].call(n,i,r,o)}(n,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];!function(e,t,n,i){if(t)e.apply(n,i);else for(var r=e.length,o=s(e,r),u=0;u<r;++u)o[u].apply(n,i)}(n,f,this,r)}return!0},t.prototype.addListener=function(e,t){return i(this,e,t,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(e,t){return i(this,e,t,!0)},t.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,r(this,e,t)),this},t.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,r(this,e,t)),this},t.prototype.removeListener=function(t,n){var i,r,o,s,u;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[t]))return this;if(i===n||i.listener&&i.listener===n)0==--this._eventsCount?this._events=new e:(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||n));else if("function"!=typeof i){for(o=-1,s=i.length;s-- >0;)if(i[s]===n||i[s].listener&&i[s].listener===n){u=i[s].listener,o=s;break}if(o<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new e,this;delete r[t]}else!function(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}(i,o);r.removeListener&&this.emit("removeListener",t,u||n)}return this},t.prototype.removeAllListeners=function(t){var n,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new e,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new e:delete i[t]),this;if(0===arguments.length){for(var r,o=Object.keys(i),s=0;s<o.length;++s)"removeListener"!==(r=o[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new e,this._eventsCount=0,this}if("function"==typeof(n=i[t]))this.removeListener(t,n);else if(n)do{this.removeListener(t,n[n.length-1])}while(n[0]);return this},t.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},t.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):o.call(e,t)},t.prototype.listenerCount=o,t.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};return u.prototype=Object.create(t.prototype),u.prototype.register=function(e,t){if(t=t||{},!e)throw new Error("Attempting to register with an invalid id");var n=this.nodes[e]||h(t);if(n.parent){var i=this.nodes[n.parent]||h();-1===i.children.indexOf(e)&&i.children.push(e),n.parent=t.parent,this.nodes[t.parent]=i}this.nodes[e]=n},u.prototype.unregister=function(e){var t=this.nodes[e];if(t){var n=this.nodes[t.parent];n&&(n.children=n.children.filter(function(t){return t!==e}),n.activeChild===e&&(n.activeChild=void 0)),this.currentFocus===e&&(this.blur(e),this.currentFocus=void 0),delete this.nodes[e],t.children.forEach(this.unregister.bind(this))}},u.prototype.blur=function(e){e=e||this.currentFocus;this.nodes[e]&&this.emit("blur",e)},u.prototype.focus=function(e){e=e||this.currentFocus;var t=this.nodes[e];if(t){var n=t.activeChild||t.children[0];if(n)return this.focus(n);this.blur(),this.currentFocus=e,this.emit("focus",e),this._bubbleActive(e)}},u.prototype.handleKeyEvent=function(e){this._bubbleKeyEvent(e,this.currentFocus)},u.prototype._isValidLRUDEvent=function(e,t){var n=e.keyCode;return"horizontal"===t.orientation&&(u.KEY_CODES[n]===u.KEY_MAP.LEFT||u.KEY_CODES[n]===u.KEY_MAP.RIGHT)||"vertical"===t.orientation&&(u.KEY_CODES[n]===u.KEY_MAP.UP||u.KEY_CODES[n]===u.KEY_MAP.DOWN)},u.prototype._getNextActiveIndex=function(e,t,n){var i=t+n,r=e.children.length;return e.wrapping&&-1===i?r-1:e.wrapping&&i===r?0:i},u.prototype._getEventOffset=function(e){return u.KEY_CODES[e.keyCode]===u.KEY_MAP.RIGHT||u.KEY_CODES[e.keyCode]===u.KEY_MAP.DOWN?1:-1},u.prototype._updateGrid=function(e){var t=this,n=e.activeChild||e.children[0],i=this.nodes[n],r=i.activeChild||i.children[0];if(r){var o=i.children.indexOf(r);e.children.forEach(function(e){var n=t.nodes[e];t._setActiveChild(e,n.children[o]||n.activeChild)})}},u.prototype._bubbleKeyEvent=function(e,t){var n=this.nodes[t];if(n){if(u.KEY_CODES[e.keyCode]===u.KEY_MAP.ENTER)return this.emit("select",t);if(this._isValidLRUDEvent(e,n)){var i=n.activeChild||n.children[0],r=n.children.indexOf(i),o=this._getEventOffset(e),s=this._getNextActiveIndex(n,r,o),h=n.children[s];if(h)return n.grid&&this._updateGrid(n),this.emit("move",{id:t,orientation:n.orientation,carousel:n.carousel,offset:o,enter:{id:h,index:s},leave:{id:i,index:r}}),this.focus(h),e.stopPropagation()}this._bubbleKeyEvent(e,n.parent)}},u.prototype._setActiveChild=function(e,t){var n=this.nodes[e].activeChild;n!==t&&(n&&this.emit("deactivate",n),this.emit("activate",t),this.nodes[e].activeChild=t)},u.prototype._bubbleActive=function(e){var t=this.nodes[e];t.parent&&(this._setActiveChild(t.parent,e),this._bubbleActive(t.parent))},u.KEY_CODES={38:"UP",40:"DOWN",37:"LEFT",39:"RIGHT",13:"ENTER"},u.KEY_MAP={LEFT:"LEFT",RIGHT:"RIGHT",UP:"UP",DOWN:"DOWN",ENTER:"ENTER"},u});