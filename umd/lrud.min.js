!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Lrud=e()}(this,function(){"use strict";function t(){}t.prototype={on:function(t,e,i){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:i}),this},once:function(t,e,i){var n=this;function r(){n.off(t,r),e.apply(i,arguments)}return r._=e,this.on(t,r,i)},emit:function(t){for(var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),n=0,r=i.length;n<r;n++)i[n].fn.apply(i[n].ctx,e);return this},off:function(t,e){var i=this.e||(this.e={}),n=i[t],r=[];if(n&&e)for(var o=0,s=n.length;o<s;o++)n[o].fn!==e&&n[o].fn._!==e&&r.push(n[o]);return r.length?i[t]=r:delete i[t],this}};var e=t,h=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable;var i=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,n,r=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),o=1;o<arguments.length;o++){for(var s in i=Object(arguments[o]))d.call(i,s)&&(r[s]=i[s]);if(h){n=h(i);for(var c=0;c<n.length;c++)u.call(i,n[c])&&(r[n[c]]=i[n[c]])}}return r},n="LEFT",r="RIGHT",o="UP",s="DOWN",c="ENTER",a={map:{LEFT:n,RIGHT:r,UP:o,DOWN:s,ENTER:c},codes:{4:n,21:n,37:n,214:n,205:n,218:n,5:r,22:r,39:r,213:r,206:r,217:r,29460:o,19:o,38:o,211:o,203:o,215:o,29461:s,20:s,40:s,212:s,204:s,216:s,29443:c,13:c,67:c,32:c,23:c,195:c}},f=function(t,e,i){return t===e||t===i},l=function(t){return t&&!!t.orientation};function v(){this.nodes={},this.root=null,this.currentFocus=null}return v.prototype=Object.create(e.prototype),i(v.prototype,{register:function(t,e){if(!t)throw new Error("Attempting to register with an invalid id");var i=this._createNode(t,e);if(i.parent){var n=this._createNode(i.parent);-1===n.children.indexOf(t)&&n.children.push(t),this.nodes[i.parent]=n}else this.root=t;this.nodes[t]=i},unregister:function(e){var t=this.nodes[e];if(t){var i=this.nodes[t.parent];i&&(i.children=i.children.filter(function(t){return t!==e}),i.activeChild===e&&(i.activeChild=void 0)),this.currentFocus===e&&(this.blur(),this.currentFocus=void 0),delete this.nodes[e],t.children.forEach(this.unregister.bind(this))}},blur:function(t){var e=this.nodes[t]||this.nodes[this.currentFocus];e&&this.emit("blur",e.id)},focus:function(t){var e=this.nodes[t]||this.nodes[this.currentFocus]||this.nodes[this.root];if(e){var i=e.activeChild||e.children[0];if(i)return this.focus(i);this.blur(),this.currentFocus=e.id,this.emit("focus",this.currentFocus),this._bubbleActive(this.currentFocus)}},handleKeyEvent:function(t){this._bubbleKeyEvent(t,this.currentFocus)},destroy:function(){this.e={},this.nodes={},this.root=null,this.currentFocus=null},setActiveChild:function(t,e){var i=this.nodes[t];i&&-1!==i.children.indexOf(e)&&i.activeChild!==e&&(i.activeChild&&this.emit("inactive",i.activeChild),this.emit("active",e),i.activeChild=e)},setActiveIndex:function(t,e){var i=this.nodes[t];i&&i.children[e]&&this.setActiveChild(t,i.children[e])},_createNode:function(t,e){return i({id:t,children:[]},this.nodes[t]||{},e||{})},_findChild:function(t,e){if(t){var i=t.activeChild||t.children[0],n=this.nodes[i];return n&&!e(n)?this._findChild(n,e):n}},_updateGrid:function(t){var e=this._findChild(t,l);if(e){var i=e.activeChild||e.children[0],n=e.children.indexOf(i);t.children.forEach(function(t){var e=this.nodes[t],i=l(e)?e:this._findChild(e,l);i&&this.setActiveIndex(i.id,Math.min(i.children.length-1,n))}.bind(this))}},_bubbleKeyEvent:function(t,e){var i=this.nodes[e];if(i){var n,r,o=v.KEY_CODES[t.keyCode];if(o===v.KEY_MAP.ENTER)return this.emit("select",e);if(n=t,"horizontal"===(r=i).orientation&&f(v.KEY_CODES[n.keyCode],v.KEY_MAP.LEFT,v.KEY_MAP.RIGHT)||"vertical"===r.orientation&&f(v.KEY_CODES[n.keyCode],v.KEY_MAP.UP,v.KEY_MAP.DOWN)){var s=i.activeChild||i.children[0],c=i.children.indexOf(s),h=f(o,v.KEY_MAP.RIGHT,v.KEY_MAP.DOWN)?1:-1,d=c+h,u=i.children.length,a=i.wrapping?(d+u)%u:d,l=i.children[a];if(l)return i.grid&&this._updateGrid(i),this.emit("move",{id:e,offset:h,orientation:i.orientation,enter:{id:l,index:a},leave:{id:s,index:c}}),this.focus(l),t.stopPropagation()}this._bubbleKeyEvent(t,i.parent)}},_bubbleActive:function(t){var e=this.nodes[t];e.parent&&(this.setActiveChild(e.parent,t),this._bubbleActive(e.parent))}}),v.KEY_MAP=a.map,v.KEY_CODES=a.codes,v});